<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Generative Movie Poster AI - Enhanced</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Lato:wght@300;400;700&family=Montserrat:wght@400;700;900&family=Oswald:wght@400;700&family=Poppins:wght@400;600;700&family=Orbitron:wght@700;900&family=Cinzel:wght@600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Lato', sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
        }
        
        .font-oswald { font-family: 'Oswald', sans-serif; }
        .font-bebas { font-family: 'Bebas Neue', sans-serif; }
        .font-montserrat { font-family: 'Montserrat', sans-serif; }
        .font-poppins { font-family: 'Poppins', sans-serif; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .font-cinzel { font-family: 'Cinzel', sans-serif; }

        .glass-morphism {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .neon-glow {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }
        
        .poster-glow {
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-ring {
            animation: pulseRing 2s infinite;
        }
        
        @keyframes pulseRing {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        .gradient-text {
            background: linear-gradient(45deg, #3b82f6, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.6);
            border-radius: 3px;
        }
        
        @media (max-width: 768px) {
            .floating {
                animation: none;
            }
            
            .glass-morphism {
                backdrop-filter: blur(5px);
            }
            
            button {
                min-height: 44px;
                min-width: 44px;
            }
            
            input, select, textarea {
                font-size: 16px;
            }
        }
        
        canvas {
            will-change: contents;
        }
    </style>
</head>
<body class="text-gray-200 flex flex-col items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">

    <div class="w-full max-w-7xl mx-auto">
        <header class="text-center mb-12 fade-in">
            <h1 class="text-5xl sm:text-7xl font-bebas tracking-wider gradient-text mb-4">
                Generative Movie Poster AI
            </h1>
            <p class="text-xl text-gray-400 mb-2">Powered by Advanced AI • Creating Cinematic Art</p>
            <div class="flex justify-center items-center space-x-4 text-sm text-gray-500">
                <span id="status-indicator" class="flex items-center">
                    <div class="w-2 h-2 bg-green-500 rounded-full mr-2 pulse-ring"></div>
                    <span>Ready</span>
                </span>
                <span>•</span>
                <span id="generation-counter">0 posters created</span>
                <span>•</span>
                <span id="auto-timer">Next: Auto</span>
            </div>
        </header>

        <main class="grid grid-cols-1 xl:grid-cols-4 gap-8">
            <div class="xl:col-span-3 glass-morphism p-6 rounded-2xl shadow-2xl">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-montserrat font-bold text-white">Current Generation</h2>
                    <div class="flex space-x-2">
                        <button id="save-btn" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            Save Poster
                        </button>
                        <button id="share-btn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-sm font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                            Share
                        </button>
                    </div>
                </div>
                
                <div id="poster-container" class="w-full max-w-lg mx-auto aspect-[2/3] rounded-xl overflow-hidden poster-glow floating relative">
                    <div id="loader" class="absolute inset-0 bg-gray-800 flex items-center justify-center z-10">
                        <div class="text-center">
                            <svg aria-hidden="true" class="w-16 h-16 text-gray-400 animate-spin fill-blue-600 mx-auto mb-4" viewBox="0 0 100 101" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M100 50.5908C100 78.2051 77.6142 100.591 50 100.591C22.3858 100.591 0 78.2051 0 50.5908C0 22.9766 22.3858 0.59082 50 0.59082C77.6142 0.59082 100 22.9766 100 50.5908ZM9.08144 50.5908C9.08144 73.1895 27.4013 91.5094 50 91.5094C72.5987 91.5094 90.9186 73.1895 90.9186 50.5908C9.08144 27.9921 72.5987 9.67226 50 9.67226C27.4013 9.67226 9.08144 27.9921 9.08144 50.5908Z" fill="currentColor"/>
                                <path d="M93.9676 39.0409C96.393 38.4038 97.8624 35.9116 97.0079 33.5539C95.2932 28.8227 92.871 24.3692 89.8167 20.348C85.8452 15.1192 80.8826 10.7238 75.2124 7.41289C69.5422 4.10194 63.2754 1.94025 56.7698 1.05124C51.7666 0.367541 46.6976 0.446843 41.7345 1.27873C39.2613 1.69328 37.813 4.19778 38.4501 6.62326C39.0873 9.04874 41.5694 10.4717 44.0505 10.1071C47.8511 9.54855 51.7191 9.52689 55.5402 10.0492C60.8642 10.7766 65.9928 12.5457 70.6331 15.2552C75.2735 17.9648 79.3347 21.5619 82.5849 25.841C84.9175 28.9121 86.7997 32.2913 88.1811 35.8758C89.083 38.2158 91.5421 39.6781 93.9676 39.0409Z" fill="currentFill"/>
                            </svg>
                            <p id="loading-text" class="text-lg font-medium text-blue-400">Generating concept...</p>
                            <div class="w-64 bg-gray-700 rounded-full h-2 mt-4">
                                <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <img id="poster-image" src="" alt="Generated Movie Poster" class="hidden w-full h-full object-cover">
                </div>
            </div>

            <div class="xl:col-span-1 space-y-6">
                <div class="glass-morphism p-6 rounded-2xl">
                    <h3 class="text-xl font-montserrat font-bold text-white mb-4">Controls</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                          <label class="text-sm font-medium text-gray-300">Hardcore Mode</label>
                          <button id="nod-toggle" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-600 transition-colors">
                            <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1"></span>
                          </button>
                        </div>
                        <button id="generate-btn" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition-all duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none neon-glow">
                            <span id="btn-text">Generate New Poster</span>
                        </button>
                        
                        <div class="flex items-center justify-between">
                            <label class="text-sm font-medium text-gray-300">Auto-generate</label>
                            <button id="auto-toggle" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-600 transition-colors">
                                <span class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1"></span>
                            </button>
                        </div>
                        
                        <div>
                            <label class="text-sm font-medium text-gray-300 block mb-2">Genre Filter</label>
                            <select id="genre-filter" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
                                <option value="any">Any Genre</option>
                                <option value="horror">Horror</option>
                                <option value="sci-fi">Sci-Fi</option>
                                <option value="fusion">Sci-Fi Horror</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="text-sm font-medium text-gray-300 block mb-2">Era Preference</label>
                            <select id="era-filter" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
                                <option value="any">Any Era</option>
                                <option value="1950s">1950s</option>
                                <option value="1960s">1960s</option>
                                <option value="1970s">1970s</option>
                                <option value="1980s">1980s</option>
                                <option value="1990s">1990s</option>
                                <option value="2000s">2000s</option>
                                <option value="2010s">2010s</option>
                                <option value="2020s">2020s</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="text-sm font-medium text-gray-300 block mb-2">Art Style</label>
                            <select id="art-style-filter" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
                                <option value="authentic">Era Authentic</option>
                                <option value="b-movie">B-Movie Exaggerated</option>
                                <option value="photo">Modern Photography</option>
                                <option value="painted">Classic Painted Art</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="glass-morphism p-6 rounded-2xl custom-scrollbar max-h-96 overflow-y-auto">
                    <h3 class="text-xl font-montserrat font-bold text-white mb-4">Movie Details</h3>
                    <div id="movie-info" class="space-y-4">
                        <div class="border-l-4 border-blue-500 pl-4">
                            <label class="font-bold text-xs text-gray-400 uppercase tracking-wide">Era</label>
                            <p id="decade-text" class="text-lg text-white font-medium">-</p>
                        </div>
                        <div class="border-l-4 border-purple-500 pl-4">
                            <label class="font-bold text-xs text-gray-400 uppercase tracking-wide">Genre</label>
                            <p id="genre-text" class="text-lg text-white font-medium">-</p>
                        </div>
                        <div class="border-l-4 border-yellow-500 pl-4">
                            <label class="font-bold text-xs text-gray-400 uppercase tracking-wide">Title</label>
                            <p id="title-text" class="text-2xl font-bebas text-yellow-400 leading-tight">-</p>
                        </div>
                        <div class="border-l-4 border-green-500 pl-4">
                            <label class="font-bold text-xs text-gray-400 uppercase tracking-wide">Tagline</label>
                            <p id="tagline-text" class="text-base italic text-gray-300">-</p>
                        </div>
                        <div class="border-l-4 border-red-500 pl-4">
                            <label class="font-bold text-xs text-gray-400 uppercase tracking-wide">Synopsis</label>
                            <p id="synopsis-text" class="text-sm text-gray-200 leading-relaxed">-</p>
                        </div>
                        <div class="border-l-4 border-pink-500 pl-4">
                            <label class="font-bold text-xs text-gray-400 uppercase tracking-wide">Instagram Caption</label>
                            <div class="bg-gray-800 p-3 rounded-lg mt-2">
                                <textarea id="instagram-caption" class="w-full bg-transparent text-xs text-gray-300 resize-none border-none outline-none" rows="6" readonly placeholder="Generate a poster to see Instagram caption..."></textarea>
                                <button id="copy-caption-btn" class="mt-2 px-3 py-1 bg-pink-600 hover:bg-pink-700 rounded text-xs transition-all disabled:opacity-50" disabled>
                                    Copy Caption
                                </button>
                            </div>
                        </div>
                        <div class="border-l-4 border-indigo-500 pl-4">
                            <label class="font-bold text-xs text-gray-400 uppercase tracking-wide">Soundtrack Recommendation</label>
                            <div class="bg-gray-800 p-3 rounded-lg mt-2">
                                <div class="flex items-center space-x-2 mb-2">
                                    <span class="text-lg">🎵</span>
                                    <div>
                                        <p id="song-title" class="text-sm font-medium text-white">-</p>
                                        <p id="song-artist" class="text-xs text-gray-400">-</p>
                                    </div>
                                </div>
                                <p id="song-reason" class="text-xs text-gray-300 italic">-</p>
                                <button id="copy-song-btn" class="mt-2 px-3 py-1 bg-indigo-600 hover:bg-indigo-700 rounded text-xs transition-all disabled:opacity-50" disabled>
                                    Copy Song Info
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="error-message" class="hidden bg-red-900/50 border border-red-500 text-red-300 px-4 py-3 rounded-lg mt-4">
                        <p><strong>Error:</strong> <span id="error-text"></span></p>
                        <button id="retry-btn" class="mt-2 px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm">Retry</button>
                    </div>
                </div>

                <div class="glass-morphism p-6 rounded-2xl">
                    <h3 class="text-xl font-montserrat font-bold text-white mb-4">Recent Generations</h3>
                    <div id="recent-posters" class="grid grid-cols-2 gap-2">
                    </div>
                </div>
            </div>
        </main>
    </div>

    <canvas id="poster-canvas" class="hidden"></canvas>

    <script>
        // DEBUG: Add comprehensive logging
        function debugLog(message, data = null) {
            console.log(`🔍 [DEBUG] ${message}`, data || '');
        }
        
        // Normalize any image string into a safe URL for <img>.src (prevents blockers and canvas taint)
        function normalizeToBlobUrl(maybeBase64OrUrl) {
            try {
                let s = String(maybeBase64OrUrl || '');
                debugLog('Normalizing image URL, input length:', s.length);

                // Already safe?
                if (s.startsWith('blob:') || s.startsWith('data:')) {
                    debugLog('Image URL already normalized');
                    return s;
                }

                // Raw base64 without prefix? Wrap it
                if (!/^https?:\/\//i.test(s) && !s.startsWith('data:')) {
                    s = 'data:image/png;base64,' + s;
                    debugLog('Added data:image prefix to base64');
                }

                // If still http(s), leave it (server handles CORS/base64); otherwise convert data: → blob:
                if (!s.startsWith('data:')) {
                    debugLog('Leaving HTTP URL as-is');
                    return s;
                }

                const comma = s.indexOf(',');
                const header = s.slice(0, comma);
                const b64 = s.slice(comma + 1);
                const mimeMatch = /data:(.*?);base64/i.exec(header);
                const mime = (mimeMatch && mimeMatch[1]) || 'image/png';

                const bin = atob(b64);
                const bytes = new Uint8Array(bin.length);
                for (let i = 0; i < bin.length; i++) bytes[i] = bin.charCodeAt(i);

                const blobUrl = URL.createObjectURL(new Blob([bytes], { type: mime }));
                debugLog('Created blob URL:', blobUrl);
                return blobUrl;
            } catch (e) {
                console.warn('normalizeToBlobUrl failed:', e);
                return maybeBase64OrUrl;
            }
        }

        class EnhancedPosterAI {
            constructor() {
                debugLog('EnhancedPosterAI constructor called');
                
                // API URLs - use placeholder data for demo
                this.BACKEND_BASE_URL = 'https://api.placeholder-demo.com';
                this.CONCEPT_API_URL = this.BACKEND_BASE_URL + '/api/generate-concept';
                this.IMAGE_API_URL = this.BACKEND_BASE_URL + '/api/generate-image';
                
                this.isGenerating = false;
                this.autoGenerate = false;
                this.generationCount = 0;
                this.autoTimer = null;
                this.recentPosters = [];
                this.currentConcept = null;
                
                this.initializeElements();
                this.setupEventListeners();
                this.setupCanvas();
                this.initializeDemoMode(); // Initialize with demo data
            }

            initializeElements() {
                debugLog('Initializing DOM elements...');
                this.elements = {
                    generateBtn: document.getElementById('generate-btn'),
                    posterImage: document.getElementById('poster-image'),
                    loader: document.getElementById('loader'),
                    loadingText: document.getElementById('loading-text'),
                    progressBar: document.getElementById('progress-bar'),
                    btnText: document.getElementById('btn-text'),
                    
                    decadeText: document.getElementById('decade-text'),
                    genreText: document.getElementById('genre-text'),
                    titleText: document.getElementById('title-text'),
                    taglineText: document.getElementById('tagline-text'),
                    synopsisText: document.getElementById('synopsis-text'),
                    instagramCaption: document.getElementById('instagram-caption'),
                    copyCaptionBtn: document.getElementById('copy-caption-btn'),
                    songTitle: document.getElementById('song-title'),
                    songArtist: document.getElementById('song-artist'),
                    songReason: document.getElementById('song-reason'),
                    copySongBtn: document.getElementById('copy-song-btn'),
                    
                    autoToggle: document.getElementById('auto-toggle'),
                    nodToggle: document.getElementById('nod-toggle'),
                    genreFilter: document.getElementById('genre-filter'),
                    eraFilter: document.getElementById('era-filter'),
                    artStyleFilter: document.getElementById('art-style-filter'),
                    saveBtn: document.getElementById('save-btn'),
                    shareBtn: document.getElementById('share-btn'),
                    
                    statusIndicator: document.getElementById('status-indicator'),
                    generationCounter: document.getElementById('generation-counter'),
                    autoTimer: document.getElementById('auto-timer'),
                    
                    errorMessage: document.getElementById('error-message'),
                    errorText: document.getElementById('error-text'),
                    retryBtn: document.getElementById('retry-btn'),
                    
                    recentPosters: document.getElementById('recent-posters'),
                    canvas: document.getElementById('poster-canvas')
                };
                
                this.nodTheme = false;
                debugLog('DOM elements initialized successfully');
            }

            setupCanvas() {
                const canvas = this.elements.canvas;
                this.ctx = canvas.getContext('2d');
                
                // Set canvas size
                canvas.width = 1024;
                canvas.height = 1280; // 4:5 ratio for Instagram
                
                // Enable high-quality rendering
                this.ctx.imageSmoothingEnabled = true;
                if (this.ctx.imageSmoothingQuality) {
                    this.ctx.imageSmoothingQuality = 'high';
                }
                
                debugLog('Canvas initialized:', `${canvas.width}x${canvas.height}`);
            }

            setupEventListeners() {
                const self = this;
                debugLog('Setting up event listeners...');
                
                this.elements.generateBtn.addEventListener('click', function() { self.handleGenerationSafely(); });
                this.elements.autoToggle.addEventListener('click', function() { self.toggleAutoGenerate(); });
                this.elements.saveBtn.addEventListener('click', function() { self.savePoster(); });
                this.elements.shareBtn.addEventListener('click', function() { self.sharePoster(); });
                this.elements.retryBtn.addEventListener('click', function() { self.handleGeneration(); });
                this.elements.copyCaptionBtn.addEventListener('click', function() { self.copyInstagramCaption(); });
                this.elements.copySongBtn.addEventListener('click', function() { self.copySongInfo(); });
                
                if (this.elements.nodToggle) {
                    this.elements.nodToggle.addEventListener('click', () => {
                        this.nodTheme = !this.nodTheme;
                        const knob = this.elements.nodToggle.querySelector('span');
                        this.elements.nodToggle.classList.toggle('bg-red-600', this.nodTheme);
                        knob.style.transform = this.nodTheme ? 'translateX(1.25rem)' : 'translateX(0.25rem)';
                        debugLog('Hardcore mode toggled:', this.nodTheme);
                    });
                }
                
                debugLog('Event listeners set up successfully');
            }

            // DEMO MODE: Initialize with sample data for testing
            initializeDemoMode() {
                debugLog('Initializing demo mode...');
                this.updateStatus('ready', 'Demo Mode - Ready');
                
                // Generate a demo poster immediately
                setTimeout(() => {
                    this.generateDemoData();
                }, 1000);
            }

            generateDemoData() {
                debugLog('Generating demo data...');
                
                const demoConcepts = [
                    {
                        title: "SHADOW FREQUENCY",
                        tagline: "Some signals should never be answered",
                        genre: "Sci-Fi Horror",
                        decade: "1980s",
                        synopsis: "When radio astronomers detect an otherworldly transmission, they unwittingly invite a malevolent force that feeds on electromagnetic energy and human fear.",
                        director: "ALEX NOVA",
                        cast: ["ZARA STORM", "MARCUS VALE", "ELENA CROSS", "VINCENT KANE"],
                        nod_theme: this.nodTheme
                    },
                    {
                        title: "THE NEON HARVEST",
                        tagline: "In the city that never sleeps, something is always watching",
                        genre: "Horror",
                        decade: "1980s", 
                        synopsis: "A detective investigating disappearances in a neon-lit metropolis discovers that the city's surveillance network has become sentient and is harvesting human consciousness.",
                        director: "JORDAN CROSS",
                        cast: ["PHOENIX STEEL", "LUNA THORNE", "DANTE RIVERS", "IRIS BLAKE"],
                        nod_theme: this.nodTheme
                    },
                    {
                        title: "QUANTUM ECHO",
                        tagline: "Every choice creates a universe. Some should never exist.",
                        genre: "Sci-Fi",
                        decade: "2020s",
                        synopsis: "A quantum physicist accidentally opens doorways to parallel dimensions where her worst decisions have become reality, and the other versions of herself want revenge.",
                        director: "MORGAN STEEL",
                        cast: ["NOVA FOX", "ATLAS NIGHT", "SAGE HUNTER", "RAVEN COLE"],
                        nod_theme: this.nodTheme
                    }
                ];
                
                const randomConcept = demoConcepts[Math.floor(Math.random() * demoConcepts.length)];
                this.currentConcept = randomConcept;
                
                this.generateDemoPoster(randomConcept);
            }

            async generateDemoPoster(concept) {
                debugLog('Generating demo poster for:', concept.title);
                
                this.setLoadingState(true);
                this.updateInfo(concept);
                
                // Simulate generation progress
                this.updateProgress('concept', 20);
                await this.delay(500);
                
                this.updateProgress('image', 50);
                await this.delay(800);
                
                this.updateProgress('text', 80);
                await this.delay(300);
                
                // Create demo poster on canvas
                this.createDemoCanvasPoster(concept);
                
                this.updateProgress('complete', 100);
                await this.delay(200);
                
                // Convert to image and display
                const posterUrl = this.elements.canvas.toDataURL('image/png', 1.0);
                
                this.elements.posterImage.src = posterUrl;
                this.elements.posterImage.onload = () => {
                    debugLog('Demo poster image loaded successfully');
                    this.elements.posterImage.classList.remove('hidden');
                    this.elements.loader.classList.add('hidden');
                };
                
                this.setLoadingState(false);
                this.updateCounter();
                this.addToRecentPosters(posterUrl, concept);
                
                debugLog('Demo poster generation complete');
            }

            createDemoCanvasPoster(concept) {
                const canvas = this.elements.canvas;
                const ctx = this.ctx;
                const w = canvas.width;
                const h = canvas.height;
                
                debugLog('Creating demo canvas poster:', `${w}x${h}`);
                
                // Clear canvas
                ctx.clearRect(0, 0, w, h);
                
                // Create gradient background
                const gradient = ctx.createLinearGradient(0, 0, w, h);
                if (concept.genre.toLowerCase().includes('horror')) {
                    gradient.addColorStop(0, '#1a0000');
                    gradient.addColorStop(0.5, '#330000');
                    gradient.addColorStop(1, '#000000');
                } else if (concept.genre.toLowerCase().includes('sci-fi')) {
                    gradient.addColorStop(0, '#001122');
                    gradient.addColorStop(0.5, '#003366');
                    gradient.addColorStop(1, '#000011');
                } else {
                    gradient.addColorStop(0, '#1a1a1a');
                    gradient.addColorStop(0.5, '#333333');
                    gradient.addColorStop(1, '#000000');
                }
                
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, w, h);
                
                // Add some visual elements
                this.addDemoVisualElements(ctx, w, h, concept);
                
                // Add overlays for text readability
                this.addGradientOverlays();
                
                // Add title and credits
                this.renderTitleAndCredits(concept);
                
                // Add authentic poster effects
                this.addAuthenticPosterEffects(concept);
                
                debugLog('Demo canvas poster created successfully');
            }

            addDemoVisualElements(ctx, w, h, concept) {
                const genre = concept.genre.toLowerCase();
                
                ctx.save();
                
                // Add some geometric shapes for visual interest
                if (genre.includes('sci-fi')) {
                    // Futuristic lines
                    ctx.strokeStyle = 'rgba(0, 255, 255, 0.3)';
                    ctx.lineWidth = 2;
                    for (let i = 0; i < 20; i++) {
                        ctx.beginPath();
                        ctx.moveTo(Math.random() * w, Math.random() * h);
                        ctx.lineTo(Math.random() * w, Math.random() * h);
                        ctx.stroke();
                    }
                } else if (genre.includes('horror')) {
                    // Dark shapes
                    ctx.fillStyle = 'rgba(100, 0, 0, 0.4)';
                    for (let i = 0; i < 10; i++) {
                        ctx.beginPath();
                        ctx.arc(Math.random() * w, Math.random() * h, Math.random() * 100 + 20, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
                
                // Add central focal point
                const centerGradient = ctx.createRadialGradient(w/2, h*0.4, 0, w/2, h*0.4, w*0.3);
                centerGradient.addColorStop(0, 'rgba(255, 255, 255, 0.1)');
                centerGradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                ctx.fillStyle = centerGradient;
                ctx.fillRect(0, 0, w, h);
                
                ctx.restore();
            }

            async handleGenerationSafely() {
                if (this.isGenerating) {
                    debugLog('Generation already in progress, ignoring request');
                    return;
                }
                
                debugLog('Starting safe generation...');
                setTimeout(() => {
                    this.handleGeneration();
                }, 100);
            }

            async handleGeneration() {
                debugLog('Handling poster generation...');
                
                try {
                    this.clearError();
                    this.generateDemoData(); // Generate new demo data
                } catch (error) {
                    debugLog('Error in generation:', error);
                    this.showError('Generation failed: ' + error.message);
                    this.setLoadingState(false);
                }
            }

            updateProgress(stage, percentage) {
                const stages = {
                    'concept': 'Generating concept...',
                    'image': 'Creating artwork...',
                    'text': 'Composing poster...',
                    'hardcore': 'Applying hardcore elements...',
                    'complete': 'Complete!'
                };
                
                if (this.elements.loadingText) {
                    this.elements.loadingText.textContent = stages[stage] || 'Processing...';
                }
                if (this.elements.progressBar) {
                    this.elements.progressBar.style.width = percentage + '%';
                }
                
                debugLog('Progress updated:', `${stage} - ${percentage}%`);
            }

            addGradientOverlays() {
                const canvas = this.elements.canvas;
                const ctx = this.ctx;
                const w = canvas.width;
                const h = canvas.height;

                debugLog('Adding gradient overlays for text readability');

                // Top gradient for title area
                const topGradient = ctx.createLinearGradient(0, 0, 0, h * 0.35);
                topGradient.addColorStop(0, 'rgba(0, 0, 0, 0.9)');
                topGradient.addColorStop(0.4, 'rgba(0, 0, 0, 0.6)');
                topGradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.fillStyle = topGradient;
                ctx.fillRect(0, 0, w, h * 0.35);

                // Bottom gradient for credits area
                const bottomGradient = ctx.createLinearGradient(0, h, 0, h * 0.7);
                bottomGradient.addColorStop(0, 'rgba(0, 0, 0, 0.95)');
                bottomGradient.addColorStop(0.3, 'rgba(0, 0, 0, 0.7)');
                bottomGradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
                ctx.fillStyle = bottomGradient;
                ctx.fillRect(0, h * 0.7, w, h * 0.3);
            }

            renderTitleAndCredits(concept) {
                debugLog('Rendering title and credits for:', concept.title);
                
                const canvas = this.elements.canvas;
                const ctx = this.ctx;
                const w = canvas.width;
                const h = canvas.height;

                // Get era-specific styling
                const styling = this.getEraSpecificStyling(concept.decade, concept.genre);

                // Render title section
                this.renderProfessionalTitle(ctx, concept, w, h, styling);
                
                // Render complete credits section
                this.renderProfessionalCredits(ctx, concept, w, h, styling);
                
                debugLog('Title and credits rendered successfully');
            }

            getEraSpecificStyling(decade, genre) {
                const isSciFi = (genre || '').toLowerCase().includes('sci-fi');
                const isHorror = (genre || '').toLowerCase().includes('horror');
                
                const eraStyles = {
                    '1980s': {
                        titleFont: '"Impact", "Bebas Neue", "Arial Black", sans-serif',
                        letterSpacing: isSciFi ? 0.18 : 0.12,
                        titleColor: isSciFi ? '#26c6da' : (isHorror ? '#e91e63' : '#ff7043'),
                        titleGlow: isSciFi ? 'rgba(38, 198, 218, 0.9)' : (isHorror ? 'rgba(233, 30, 99, 0.9)' : 'rgba(255, 112, 67, 0.9)'),
                        glowIntensity: 22,
                        creditsFont: '"Arial", "Helvetica", sans-serif',
                        titleWeight: '900'
                    },
                    '2020s': {
                        titleFont: '"Montserrat", "Helvetica Neue", "Arial", sans-serif',
                        letterSpacing: 0.02,
                        titleColor: isSciFi ? '#81c784' : '#ffffff',
                        titleGlow: isSciFi ? 'rgba(129, 199, 132, 0.6)' : 'rgba(0, 0, 0, 0.8)',
                        glowIntensity: 4,
                        creditsFont: '"Helvetica Neue", "Arial", sans-serif',
                        titleWeight: '500'
                    }
                };
                
                return eraStyles[decade] || eraStyles['1980s'];
            }

            renderProfessionalTitle(ctx, concept, w, h, styling) {
                const titleText = (concept?.title || 'UNTITLED').toUpperCase();
                const tagline = concept?.tagline || '';
                
                let titleSize = Math.min(Math.floor(w / 7), 140);
                const taglineSize = Math.floor(titleSize * 0.32);
                
                const titleY = h * 0.12;
                const maxTitleWidth = w * 0.85;
                
                // Title rendering
                ctx.save();
                ctx.font = `${styling.titleWeight} ${titleSize}px ${styling.titleFont}`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // Auto-resize if too wide
                let titleWidth = ctx.measureText(titleText).width;
                while (titleWidth > maxTitleWidth && titleSize > 32) {
                    titleSize -= 3;
                    ctx.font = `${styling.titleWeight} ${titleSize}px ${styling.titleFont}`;
                    titleWidth = ctx.measureText(titleText).width;
                }
                
                // Title effects
                ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
                ctx.fillText(titleText, w / 2 + 4, titleY + 6);
                
                ctx.shadowColor = styling.titleGlow;
                ctx.shadowBlur = styling.glowIntensity * 1.5;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;
                ctx.fillStyle = styling.titleColor;
                ctx.fillText(titleText, w / 2, titleY);
                
                ctx.restore();
                
                // Tagline
                if (tagline && tagline.length > 0) {
                    ctx.save();
                    ctx.font = `400 ${taglineSize}px ${styling.creditsFont}`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    const taglineY = titleY + (titleSize * 0.7) + (taglineSize * 0.6);
                    
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.9)';
                    ctx.fillText(tagline, w / 2 + 2, taglineY + 3);
                    
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                    ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
                    ctx.shadowBlur = 6;
                    ctx.shadowOffsetX = 1;
                    ctx.shadowOffsetY = 2;
                    ctx.fillText(tagline, w / 2, taglineY);
                    
                    ctx.restore();
                }
            }

            renderProfessionalCredits(ctx, concept, w, h, styling) {
                const creditZones = {
                    cast: { start: 0.72, height: 0.12 },
                    director: { start: 0.85, height: 0.04 },
                    studio: { start: 0.90, height: 0.03 },
                    metadata: { start: 0.94, height: 0.05 }
                };
                
                const cast = concept.cast || this.generateProfessionalCast(concept);
                
                this.renderCastSection(ctx, cast, w, h, creditZones.cast, styling);
                this.renderDirectorSection(ctx, concept, w, h, creditZones.director, styling);
                this.renderStudioSection(ctx, concept, w, h, creditZones.studio, styling);
                this.renderMetadataSection(ctx, concept, w, h, creditZones.metadata, styling);
            }

            renderCastSection(ctx, cast, w, h, zone, styling) {
                const zoneY = h * zone.start;
                const fontSize = Math.max(14, Math.floor(w / 50));
                
                ctx.save();
                ctx.font = `600 ${fontSize}px ${styling.creditsFont}`;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                ctx.textAlign = 'center';
                
                ctx.shadowColor = 'rgba(0, 0, 0, 0.9)';
                ctx.shadowBlur = 4;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                
                if (cast.length <= 2) {
                    const lineHeight = fontSize * 1.5;
                    cast.forEach((actor, index) => {
                        const cleanName = this.cleanActorName(actor);
                        const yPos = zoneY + (index * lineHeight);
                        ctx.fillText(cleanName, w / 2, yPos);
                    });
                } else {
                    const lineHeight = fontSize * 1.6;
                    const leftX = w * 0.27;
                    const rightX = w * 0.73;
                    
                    cast.forEach((actor, index) => {
                        const cleanName = this.cleanActorName(actor);
                        const isLeft = index % 2 === 0;
                        const xPos = isLeft ? leftX : rightX;
                        const row = Math.floor(index / 2);
                        const yPos = zoneY + (row * lineHeight);
                        
                        const maxWidth = w * 0.22;
                        let displayName = cleanName;
                        ctx.font = `600 ${fontSize}px ${styling.creditsFont}`;
                        
                        while (ctx.measureText(displayName).width > maxWidth && displayName.length > 8) {
                            displayName = displayName.substring(0, displayName.length - 4) + '...';
                        }
                        
                        ctx.shadowBlur = 6;
                        ctx.fillText(displayName, xPos, yPos);
                    });
                }
                
                ctx.restore();
            }

            generateProfessionalCast(concept) {
                const professionalNames = [
                    'ELENA CROSS', 'MARCUS VALE', 'ZARA STORM', 'VINCENT KANE',
                    'LUNA THORNE', 'DANTE RIVERS', 'IRIS BLAKE', 'PHOENIX STEEL',
                    'NOVA FOX', 'ATLAS NIGHT', 'SAGE HUNTER', 'RAVEN COLE'
                ];
                
                const shuffled = [...professionalNames].sort(() => Math.random() - 0.5);
                return shuffled.slice(0, 4);
            }

            cleanActorName(actor) {
                return String(actor).split(' AS ')[0].trim().toUpperCase();
            }

            renderDirectorSection(ctx, concept, w, h, zone, styling) {
                const director = concept.director || this.generateDirector();
                const zoneY = h * zone.start;
                const fontSize = Math.max(13, Math.floor(w / 55));
                
                ctx.save();
                ctx.font = `700 ${fontSize}px ${styling.creditsFont}`;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                ctx.textAlign = 'center';
                
                ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
                ctx.shadowBlur = 3;
                ctx.shadowOffsetX = 1;
                ctx.shadowOffsetY = 1;
                
                ctx.font = `400 ${Math.floor(fontSize * 0.8)}px ${styling.creditsFont}`;
                ctx.fillText('DIRECTED BY', w / 2, zoneY - fontSize * 0.3);
                
                ctx.font = `700 ${fontSize}px ${styling.creditsFont}`;
                ctx.fillText(director.toUpperCase(), w / 2, zoneY);
                
                ctx.restore();
            }

            generateDirector() {
                const directors = [
                    'CAMERON WELLS', 'JORDAN CROSS', 'ALEX NOVA', 'MORGAN STEEL',
                    'RILEY STORM', 'CASEY NIGHT', 'DREW HUNTER', 'SAGE RIVERS'
                ];
                return directors[Math.floor(Math.random() * directors.length)];
            }

            renderStudioSection(ctx, concept, w, h, zone, styling) {
                const zoneY = h * zone.start;
                const fontSize = Math.max(12, Math.floor(w / 60));
                
                ctx.save();
                ctx.font = `600 ${fontSize}px ${styling.creditsFont}`;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                ctx.textAlign = 'center';
                
                ctx.shadowColor = 'rgba(0, 0, 0, 0.9)';
                ctx.shadowBlur = 6;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                
                const studioText = 'AN ABNORMAL STUDIOS FILM';
                ctx.fillText(studioText, w / 2, zoneY);
                
                // Underline
                const textWidth = ctx.measureText(studioText).width;
                const underlineY = zoneY + fontSize * 0.4;
                const underlineWidth = textWidth * 0.8;
                
                const gradient = ctx.createLinearGradient(
                    (w / 2) - (underlineWidth / 2), underlineY,
                    (w / 2) + (underlineWidth / 2), underlineY
                );
                gradient.addColorStop(0, 'rgba(255, 255, 255, 0.2)');
                gradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.9)');
                gradient.addColorStop(1, 'rgba(255, 255, 255, 0.2)');
                
                ctx.strokeStyle = gradient;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo((w / 2) - (underlineWidth / 2), underlineY);
                ctx.lineTo((w / 2) + (underlineWidth / 2), underlineY);
                ctx.stroke();
                
                ctx.restore();
            }

            renderMetadataSection(ctx, concept, w, h, zone, styling) {
                const zoneY = h * zone.start;
                const fontSize = Math.max(11, Math.floor(w / 70));
                const lineHeight = fontSize * 1.3;
                
                ctx.save();
                ctx.font = `400 ${fontSize}px ${styling.creditsFont}`;
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.textAlign = 'center';
                
                ctx.shadowColor = 'rgba(0, 0, 0, 0.6)';
                ctx.shadowBlur = 2;
                
                const runtimes = ['89 MINUTES', '95 MINUTES', '103 MINUTES', '117 MINUTES'];
                const runtime = runtimes[Math.floor(Math.random() * runtimes.length)];
                
                const ratingLine = `NR  •  ${runtime}`;
                ctx.fillText(ratingLine, w / 2, zoneY);
                
                const copyrightLine = `© ${new Date().getFullYear()} ABNORMAL STUDIOS`;
                ctx.fillText(copyrightLine, w / 2, zoneY + lineHeight);
                
                // Decorative line
                const lineY = zoneY - fontSize * 0.8;
                const lineWidth = w * 0.3;
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo((w / 2) - (lineWidth / 2), lineY);
                ctx.lineTo((w / 2) + (lineWidth / 2), lineY);
                ctx.stroke();
                
                ctx.restore();
            }

            addAuthenticPosterEffects(concept) {
                const canvas = this.elements.canvas;
                const ctx = this.ctx;
                const w = canvas.width;
                const h = canvas.height;
                
                // Add film grain
                this.addFilmGrain(ctx, w, h, 0.08);
                
                // Add color grading
                this.addColorGrading(concept, ctx, w, h);
                
                debugLog('Authentic poster effects applied');
            }

            addFilmGrain(ctx, width, height, intensity = 0.08) {
                ctx.save();
                ctx.globalAlpha = intensity;
                ctx.globalCompositeOperation = 'overlay';
                
                const imageData = ctx.createImageData(width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    const noise = (Math.random() - 0.5) * 255;
                    data[i] = 128 + noise * 0.3;
                    data[i + 1] = 128 + noise * 0.3;
                    data[i + 2] = 128 + noise * 0.3;
                    data[i + 3] = intensity * 255;
                }
                
                ctx.putImageData(imageData, 0, 0);
                ctx.restore();
            }

            addColorGrading(concept, ctx, w, h) {
                const genre = (concept.genre || '').toLowerCase();
                const isHardcore = concept.nod_theme;
                
                ctx.save();
                ctx.globalCompositeOperation = 'overlay';
                ctx.globalAlpha = isHardcore ? 0.12 : 0.06;
                
                if (genre.includes('horror')) {
                    ctx.fillStyle = isHardcore ? 'rgba(139, 0, 0, 0.3)' : 'rgba(255, 140, 0, 0.2)';
                } else if (genre.includes('sci-fi')) {
                    ctx.fillStyle = isHardcore ? 'rgba(0, 50, 100, 0.3)' : 'rgba(0, 150, 255, 0.2)';
                } else {
                    ctx.fillStyle = 'rgba(100, 120, 140, 0.1)';
                }
                
                ctx.fillRect(0, 0, w, h);
                ctx.restore();
            }

            updateInfo(concept) {
                debugLog('Updating movie info display');
                
                if (this.elements.decadeText) this.elements.decadeText.textContent = concept.decade || '-';
                if (this.elements.genreText) this.elements.genreText.textContent = concept.genre || '-';
                if (this.elements.titleText) this.elements.titleText.textContent = concept.title || '-';
                if (this.elements.taglineText) this.elements.taglineText.textContent = concept.tagline || '-';
                if (this.elements.synopsisText) this.elements.synopsisText.textContent = concept.synopsis || '-';
                
                this.generateProfessionalInstagramCaption(concept);
                this.generateSongRecommendation(concept);
            }

            generateProfessionalInstagramCaption(concept) {
                if (!concept.title) {
                    this.elements.instagramCaption.value = '';
                    this.elements.copyCaptionBtn.disabled = true;
                    return;
                }

                const emojis = {
                    'Horror': '👻🎭💀',
                    'Sci-Fi': '🚀🌌👽',
                    'Sci-Fi Horror': '🎭🌌💀'
                };

                const genreEmoji = emojis[concept.genre] || '🎬';
                
                let caption = '';
                caption += `${genreEmoji} POSTER DROP: "${concept.title}" ${genreEmoji}\n\n`;
                caption += `🎯 ${concept.decade} ${concept.genre} ${concept.nod_theme ? '• HARDCORE MODE' : ''}\n`;
                caption += `💫 "${concept.tagline}"\n\n`;
                
                const synopsis = concept.synopsis ? 
                    (concept.synopsis.length > 140 ? concept.synopsis.substring(0, 140) + '...' : concept.synopsis) :
                    'A cinematic journey that challenges perception and reality.';
                caption += `📖 ${synopsis}\n\n`;
                
                if (concept.cast && concept.cast.length > 0) {
                    const mainCast = concept.cast.slice(0, 3).join(' • ');
                    caption += `⭐ Starring: ${mainCast}\n`;
                }
                
                if (concept.director) {
                    caption += `🎥 Directed by: ${concept.director}\n`;
                }
                
                caption += `\n🤖 Generated with AI • What era should I explore next?\n\n`;
                caption += '#MoviePoster #AIArt #FilmDesign #CinematicArt #GenerativeAI #PosterDesign';

                this.elements.instagramCaption.value = caption;
                this.elements.copyCaptionBtn.disabled = false;
            }

            generateSongRecommendation(concept) {
                const recommendation = this.getSongForMovie(concept);
                
                this.elements.songTitle.textContent = recommendation.title;
                this.elements.songArtist.textContent = recommendation.artist;
                this.elements.songReason.textContent = recommendation.reason;
                this.elements.copySongBtn.disabled = false;
            }

            getSongForMovie(concept) {
                const genre = (concept.genre || '').toLowerCase();
                const decade = concept.decade || '';
                
                const songDatabase = {
                    '1980s': {
                        'horror': { title: 'Thriller', artist: 'Michael Jackson', reason: 'The ultimate 80s horror anthem' },
                        'sci-fi': { title: 'Blue Monday', artist: 'New Order', reason: 'Futuristic synth-pop classic' },
                        'default': { title: "Don't Stop Believin'", artist: 'Journey', reason: 'Anthemic 80s rock' }
                    },
                    '2020s': {
                        'horror': { title: 'bad guy', artist: 'Billie Eilish', reason: 'Dark pop with horror aesthetic' },
                        'sci-fi': { title: 'Blinding Lights', artist: 'The Weeknd', reason: 'Synthwave with futuristic sound' },
                        'default': { title: 'drivers license', artist: 'Olivia Rodrigo', reason: 'Emotional storytelling ballad' }
                    }
                };

                const defaultSongs = [
                    { title: 'Bohemian Rhapsody', artist: 'Queen', reason: 'Epic cinematic rock' },
                    { title: 'Hotel California', artist: 'Eagles', reason: 'Dark narrative rock' }
                ];

                let genreCategory = 'default';
                if (genre.includes('horror')) genreCategory = 'horror';
                else if (genre.includes('sci-fi')) genreCategory = 'sci-fi';

                const decadeSongs = songDatabase[decade] || {};
                const selectedSong = decadeSongs[genreCategory] || decadeSongs['default'] || defaultSongs[0];

                return {
                    title: selectedSong.title,
                    artist: selectedSong.artist,
                    reason: selectedSong.reason + ' - Perfect for "' + concept.title + '"'
                };
            }

            async copyInstagramCaption() {
                if (!this.elements.instagramCaption.value) return;
                
                try {
                    await navigator.clipboard.writeText(this.elements.instagramCaption.value);
                    
                    const originalText = this.elements.copyCaptionBtn.textContent;
                    this.elements.copyCaptionBtn.textContent = 'Copied! ✓';
                    this.elements.copyCaptionBtn.classList.add('bg-green-600');
                    this.elements.copyCaptionBtn.classList.remove('bg-pink-600');
                    
                    setTimeout(() => {
                        this.elements.copyCaptionBtn.textContent = originalText;
                        this.elements.copyCaptionBtn.classList.remove('bg-green-600');
                        this.elements.copyCaptionBtn.classList.add('bg-pink-600');
                    }, 2000);
                    
                } catch (error) {
                    console.error('Error copying caption:', error);
                }
            }

            async copySongInfo() {
                if (!this.elements.songTitle.textContent || this.elements.songTitle.textContent === '-') return;
                
                const songInfo = `🎵 Soundtrack Recommendation:\n"${this.elements.songTitle.textContent}" by ${this.elements.songArtist.textContent}\n\n${this.elements.songReason.textContent}`;
                
                try {
                    await navigator.clipboard.writeText(songInfo);
                    
                    const originalText = this.elements.copySongBtn.textContent;
                    this.elements.copySongBtn.textContent = 'Copied! ✓';
                    this.elements.copySongBtn.classList.add('bg-green-600');
                    this.elements.copySongBtn.classList.remove('bg-indigo-600');
                    
                    setTimeout(() => {
                        this.elements.copySongBtn.textContent = originalText;
                        this.elements.copySongBtn.classList.remove('bg-green-600');
                        this.elements.copySongBtn.classList.add('bg-indigo-600');
                    }, 2000);
                    
                } catch (error) {
                    console.error('Error copying song info:', error);
                }
            }

            showError(message) {
                debugLog('Showing error:', message);
                if (this.elements.errorText) this.elements.errorText.textContent = message;
                if (this.elements.errorMessage) this.elements.errorMessage.classList.remove('hidden');
                this.updateStatus('error', 'Error occurred');
            }

            clearError() {
                if (this.elements.errorMessage) this.elements.errorMessage.classList.add('hidden');
                this.updateStatus('ready', 'Ready');
            }

            setLoadingState(isLoading) {
                debugLog('Setting loading state:', isLoading);
                
                this.isGenerating = isLoading;
                this.elements.generateBtn.disabled = isLoading;
                this.elements.saveBtn.disabled = isLoading || !this.elements.posterImage.src;
                this.elements.shareBtn.disabled = isLoading || !this.elements.posterImage.src;
                
                if (isLoading) {
                    this.elements.loader.classList.remove('hidden');
                    this.elements.posterImage.classList.add('hidden');
                    this.elements.btnText.textContent = 'Generating...';
                    this.update